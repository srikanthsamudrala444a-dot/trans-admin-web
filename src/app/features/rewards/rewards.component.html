<div class="rewards-container">
  <div class="header-section">
    <div class="header-content">
      <h1 class="page-title">
        <mat-icon class="title-icon">card_giftcard</mat-icon>
        Promotions & Offers Management
      </h1>
      <button mat-raised-button color="primary" class="create-btn" (click)="createNewPromotion()">
        <mat-icon>add</mat-icon>
        Create New Promotion
      </button>
    </div>
  </div>

  <div class="search-section">
    <mat-form-field appearance="outline" class="status-field">
        <mat-label>Status</mat-label>
        <mat-select [(ngModel)]="selectedStatus" placeholder="Status" name="status" (selectionChange)="onStatusChange()">
            <mat-option value="">All</mat-option>
            <mat-option value="Active">Active</mat-option>
            <mat-option value="Inactive">Inactive</mat-option>
            <mat-option value="Expired">Expired</mat-option>
        </mat-select>
    </mat-form-field>
    <mat-form-field appearance="outline" class="search-field">
        <mat-label>Search</mat-label>
        <input matInput placeholder="Search promotions..." [(ngModel)]="searchText" (input)="onSearchChange()">
        <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>
  </div>

  <div class="stats-section">
    <div class="stats-grid">
      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-number">{{ stats.activePromotions }}</div>
          <div class="stat-label">Active Promotions</div>
        </mat-card-content>
      </mat-card>
      
      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-number">{{ stats.totalRedemptions | number }}</div>
          <div class="stat-label">Total Redemptions</div>
        </mat-card-content>
      </mat-card>
      
      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-number">{{ stats.conversionRate }}</div>
          <div class="stat-label">Conversion Rate</div>
        </mat-card-content>
      </mat-card>
      
      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-number">{{ stats.totalRevenueImpact }}</div>
          <div class="stat-label">Total Revenue Impact        </div>

        <!-- Context Menu for Actions -->
        <div class="action-info" *ngIf="promotions.length > 0">
          <p class="info-text">
            <mat-icon>info</mat-icon>
            Click on any row to edit promotion. Right-click to delete promotion.
          </p>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
  </div>

  <div class="table-section">
    <mat-card>
      <mat-card-content>
        <div *ngIf="loading" class="loading-container">
          <mat-spinner diameter="40"></mat-spinner>
          <span class="loading-text">Loading promotions...</span>
        </div>

        <div *ngIf="!loading && promotions.length === 0" class="empty-state">
          <mat-icon class="empty-icon">card_giftcard</mat-icon>
          <h3>No Promotions Found</h3>
          <p>Get started by creating your first promotion or offer.</p>
          <button mat-raised-button color="primary" (click)="createNewPromotion()">
            <mat-icon>add</mat-icon>
            Create Promotion
          </button>
        </div>
        <table *ngIf="!loading && promotions.length > 0" mat-table [dataSource]="promotions" class="promotions-table">
          <!-- Name Column -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>NAME</th>
            <td mat-cell *matCellDef="let promotion">{{ promotion.name }}</td>
          </ng-container>

          <!-- Type Column -->
          <ng-container matColumnDef="type">
            <th mat-header-cell *matHeaderCellDef>TYPE</th>
            <td mat-cell *matCellDef="let promotion">{{ getDisplayType(promotion.type) }}</td>
          </ng-container>

          <!-- Code Column -->
          <ng-container matColumnDef="code">
            <th mat-header-cell *matHeaderCellDef>CODE</th>
            <td mat-cell *matCellDef="let promotion">
              <span class="code-text">{{ promotion.code || '-' }}</span>
            </td>
          </ng-container>

          <!-- Discount Column -->
          <ng-container matColumnDef="discount">
            <th mat-header-cell *matHeaderCellDef>DISCOUNT</th>
            <td mat-cell *matCellDef="let promotion">{{ getDisplayDiscount(promotion) }}</td>
          </ng-container>

          <!-- Validity Column -->
          <ng-container matColumnDef="validity">
            <th mat-header-cell *matHeaderCellDef>VALIDITY</th>
            <td mat-cell *matCellDef="let promotion">{{ getDisplayValidity(promotion) }}</td>
          </ng-container>

          <!-- Status Column -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>STATUS</th>
            <td mat-cell *matCellDef="let promotion">
              <mat-chip [class]="getStatusClass(promotion.status)">
                {{ promotion.status }}
              </mat-chip>
            </td>
          </ng-container>

          <!-- Usage Column -->
          <ng-container matColumnDef="usage">
            <th mat-header-cell *matHeaderCellDef>USAGE</th>
            <td mat-cell *matCellDef="let promotion">{{ promotion.currentUsage }}</td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;" 
              class="clickable-row" 
              (click)="editPromotion(row)"
              (contextmenu)="onRightClick($event, row)"
              matTooltip="Click to edit promotion â€¢ Right-click to delete"></tr>
        </table>

      </mat-card-content>
    </mat-card>
  </div>

  <div *ngIf="!loading && promotions.length > 0" class="custom-paginator-container">
    <mat-paginator
      #paginator
      [length]="totalItems"
      [pageSize]="itemsPerPage"
      [pageSizeOptions]="[5, 10, 25, 50]"
      [showFirstLastButtons]="true"
      aria-label="Promotions pagination"
    >
    </mat-paginator>

    <div class="page-jump-container">
      <span class="page-jump-label">Go to page:</span>
      <input
        type="number"
        class="page-jump-input"
        [(ngModel)]="pageJumpValue"
        [min]="1"
        [max]="totalPages"
        (keyup.enter)="jumpToPage()"
        placeholder="#"
      />
      <button
        mat-icon-button
        class="page-jump-button"
        color="primary"
        (click)="jumpToPage()"
        [disabled]="
          !pageJumpValue || pageJumpValue < 1 || pageJumpValue > totalPages
        "
        matTooltip="Jump to page"
      >
        <mat-icon>arrow_forward</mat-icon>
      </button>
    </div>
  </div>
</div>
