<div class="multi-role-access-control">
  <!-- Header Section -->
  <div class="header-section">
    <div class="header-content">
      <div class="title-group">
        <h1 class="page-title">
          <span class="title-icon">üîë</span>
          Multi-Role Access Control
        </h1>
        <p class="page-subtitle">Assign different access levels to employees.</p>
      </div>
      <button 
        class="btn btn-primary add-role-btn"
        (click)="openAddRoleModal()"
        [disabled]="isLoading">
        <span class="btn-icon">‚ûï</span>
        Add Role
      </button>
    </div>
  </div>

  <!-- Notifications -->
  <div *ngIf="notification" class="notification" [ngClass]="'notification-' + notification.type">
    <span class="notification-icon">
      <span *ngIf="notification.type === 'success'">‚úÖ</span>
      <span *ngIf="notification.type === 'error'">‚ùå</span>
      <span *ngIf="notification.type === 'warning'">‚ö†Ô∏è</span>
    </span>
    <span class="notification-message">{{ notification.message }}</span>
    <button class="notification-close" (click)="dismissNotification()">√ó</button>
  </div>

  <!-- Search and Filter Section -->
  <div class="filter-section" [formGroup]="filterForm">
    <div class="search-group">
      <div class="search-input-wrapper">
        <span class="search-icon">üîç</span>
        <input 
          type="text" 
          formControlName="search"
          placeholder="Search by Employee Name"
          class="search-input">
      </div>
    </div>
    
    <div class="filter-group">
      <div class="filter-item">
        <label for="roleType">Role Type</label>
        <select formControlName="roleType" id="roleType" class="filter-select">
          <option value="">All Roles</option>
          <option *ngFor="let role of roleTypes" [value]="role">{{ role }}</option>
        </select>
      </div>
      
      <div class="filter-item">
        <label for="accessLevel">Access Level</label>
        <select formControlName="accessLevel" id="accessLevel" class="filter-select">
          <option value="">All Levels</option>
          <option *ngFor="let level of accessLevels" [value]="level">{{ level }}</option>
        </select>
      </div>
      
      <div class="filter-item">
        <label for="department">Department</label>
        <select formControlName="department" id="department" class="filter-select">
          <option value="">All Departments</option>
          <option *ngFor="let dept of departments" [value]="dept">{{ dept }}</option>
        </select>
      </div>
    </div>

    <div class="export-group">
      <button class="btn btn-secondary" (click)="onExportRoles('csv')">
        Export CSV
      </button>
      <button class="btn btn-secondary" (click)="onExportRoles('pdf')">
        Export PDF
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Loading roles...</p>
  </div>

  <!-- Roles Table -->
  <div *ngIf="!isLoading" class="table-section">
    <div class="table-header">
      <h2>Employee Roles ({{ totalItems }} total)</h2>
    </div>
    
    <div class="table-wrapper">
      <table class="roles-table">
        <thead>
          <tr>
            <th (click)="onSort('employeeName')" class="sortable">
              Employee Name
              <span class="sort-icon" 
                    [ngClass]="{
                      'sort-asc': sortField === 'employeeName' && sortDirection === 'asc',
                      'sort-desc': sortField === 'employeeName' && sortDirection === 'desc'
                    }">
                ‚ÜïÔ∏è
              </span>
            </th>
            <th (click)="onSort('roleType')" class="sortable">
              Role
              <span class="sort-icon" 
                    [ngClass]="{
                      'sort-asc': sortField === 'roleType' && sortDirection === 'asc',
                      'sort-desc': sortField === 'roleType' && sortDirection === 'desc'
                    }">
                ‚ÜïÔ∏è
              </span>
            </th>
            <th (click)="onSort('accessLevel')" class="sortable">
              Access Level
              <span class="sort-icon" 
                    [ngClass]="{
                      'sort-asc': sortField === 'accessLevel' && sortDirection === 'asc',
                      'sort-desc': sortField === 'accessLevel' && sortDirection === 'desc'
                    }">
                ‚ÜïÔ∏è
              </span>
            </th>
            <th>Department</th>
            <th>Created Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let role of paginatedRoles" class="table-row">
            <td class="employee-cell">
              <div class="employee-info">
                <div class="employee-name">{{ role.employeeName }}</div>
                <div class="employee-email">{{ role.email }}</div>
              </div>
            </td>
            <td class="role-cell">
              <span class="role-badge">{{ role.roleType }}</span>
            </td>
            <td class="access-cell">
              <span class="access-badge" [ngClass]="getAccessLevelClass(role.accessLevel)">
                {{ getAccessLevelIcon(role.accessLevel) }} {{ role.accessLevel }}
              </span>
            </td>
            <td class="department-cell">{{ role.department }}</td>
            <td class="date-cell">{{ role.createdAt | date:'short' }}</td>
            <td class="actions-cell">
              <button 
                class="btn btn-icon btn-edit"
                (click)="openEditRoleModal(role)"
                title="Edit Role">
                ‚úèÔ∏è
              </button>
              <button 
                class="btn btn-icon btn-delete"
                (click)="onDeleteRole(role)"
                title="Delete Role">
                üóëÔ∏è
              </button>
            </td>
          </tr>
          
          <tr *ngIf="paginatedRoles.length === 0" class="no-data-row">
            <td colspan="6" class="no-data-cell">
              <div class="no-data-message">
                <span class="no-data-icon">üìã</span>
                <p>No roles found matching your criteria</p>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div *ngIf="totalPages > 1" class="pagination">
      <button 
        class="pagination-btn"
        (click)="onPageChange(currentPage - 1)"
        [disabled]="currentPage === 1">
        ‚óÄÔ∏è Previous
      </button>
      
      <span class="pagination-info">
        Page {{ currentPage }} of {{ totalPages }}
      </span>
      
      <button 
        class="pagination-btn"
        (click)="onPageChange(currentPage + 1)"
        [disabled]="currentPage === totalPages">
        Next ‚ñ∂Ô∏è
      </button>
    </div>
  </div>

  <!-- Add/Edit Role Modal -->
  <div *ngIf="showAddRoleModal" class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{ editingRole ? 'Edit Role' : 'Add New Role' }}</h3>
        <button class="modal-close" (click)="closeModal()">√ó</button>
      </div>
      
      <form [formGroup]="roleForm" (ngSubmit)="onSubmitRole()" class="modal-form">
        <div class="form-group">
          <label for="employeeId">Employee *</label>
          <select formControlName="employeeId" id="employeeId" class="form-select" [disabled]="!!editingRole">
            <option value="">Select an employee</option>
            <option *ngFor="let employee of availableEmployees" [value]="employee.id">
              {{ employee.name }} ({{ employee.department }})
            </option>
          </select>
          <div *ngIf="roleForm.get('employeeId')?.errors?.['required'] && roleForm.get('employeeId')?.touched" 
               class="field-error">
            Please select an employee
          </div>
        </div>

        <div class="form-group">
          <label for="roleType">Role Type *</label>
          <select formControlName="roleType" id="roleType" class="form-select">
            <option value="">Select a role</option>
            <option *ngFor="let role of roleTypes" [value]="role">{{ role }}</option>
          </select>
          <div *ngIf="roleForm.get('roleType')?.errors?.['required'] && roleForm.get('roleType')?.touched" 
               class="field-error">
            Please select a role type
          </div>
        </div>

        <div class="form-group">
          <label>Access Level *</label>
          <div class="access-level-options">
            <label *ngFor="let level of accessLevels" class="radio-option">
              <input 
                type="radio" 
                [value]="level" 
                formControlName="accessLevel"
                class="radio-input">
              <span class="radio-label">
                {{ getAccessLevelIcon(level) }} {{ level }}
              </span>
              <small class="access-description">
                <span *ngIf="level === 'Full'">Can view, edit, delete, and manage settings</span>
                <span *ngIf="level === 'Edit'">Can add or update data, but not delete or change system settings</span>
                <span *ngIf="level === 'Read'">Can only view information, no modification rights</span>
              </small>
            </label>
          </div>
          <div *ngIf="roleForm.get('accessLevel')?.errors?.['required'] && roleForm.get('accessLevel')?.touched" 
               class="field-error">
            Please select an access level
          </div>
        </div>

        <div class="form-group">
          <div class="permissions-toggle">
            <button 
              type="button" 
              class="btn btn-secondary"
              (click)="togglePermissionsMatrix()">
              {{ showPermissionsMatrix ? 'Hide' : 'Show' }} Permissions Matrix
            </button>
          </div>
          
          <div *ngIf="showPermissionsMatrix && roleForm.get('roleType')?.value" class="permissions-matrix">
            <h4>Permissions for {{ roleForm.get('roleType')?.value }}</h4>
            <table class="permissions-table">
              <thead>
                <tr>
                  <th>Module</th>
                  <th>View</th>
                  <th>Edit</th>
                  <th>Delete</th>
                  <th>Approve</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let permission of getDefaultPermissions(roleForm.get('roleType')?.value)">
                  <td>{{ permission.module }}</td>
                  <td class="permission-cell">
                    <span [ngClass]="permission.view ? 'permission-granted' : 'permission-denied'">
                      {{ permission.view ? '‚úÖ' : '‚ùå' }}
                    </span>
                  </td>
                  <td class="permission-cell">
                    <span [ngClass]="permission.edit ? 'permission-granted' : 'permission-denied'">
                      {{ permission.edit ? '‚úÖ' : '‚ùå' }}
                    </span>
                  </td>
                  <td class="permission-cell">
                    <span [ngClass]="permission.delete ? 'permission-granted' : 'permission-denied'">
                      {{ permission.delete ? '‚úÖ' : '‚ùå' }}
                    </span>
                  </td>
                  <td class="permission-cell">
                    <span [ngClass]="permission.approve ? 'permission-granted' : 'permission-denied'">
                      {{ permission.approve ? '‚úÖ' : '‚ùå' }}
                    </span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" (click)="closeModal()">
            Cancel
          </button>
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="!roleForm.valid || isLoading">
            {{ editingRole ? 'Update' : 'Save' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
